<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>دفترچه هوشمند رشد کودک</title>
    <style>
        /* Reset و تنظیمات پایه */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f9f7fe;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* هدر */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            text-align: center;
            border-radius: 0 0 30px 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        /* ناوبری */
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            background: white;
            border-radius: 50px;
            padding: 5px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 50px;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: #764ba2;
            color: white;
        }

        /* محتوای تب‌ها */
        .tab-content {
            display: none;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tab-content.active {
            display: block;
        }

        /* فرم‌ها */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            border-color: #764ba2;
            outline: none;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        /* نمودارها */
        .chart-container {
            height: 250px;
            margin: 30px 0;
            position: relative;
        }

        .chart {
            display: flex;
            align-items: flex-end;
            height: 200px;
            border-bottom: 2px solid #ddd;
            padding-top: 20px;
        }

        .bar-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 5px;
        }

        .bar {
            width: 30px;
            background: linear-gradient(to top, #667eea, #764ba2);
            border-radius: 5px 5px 0 0;
            transition: height 0.5s ease;
            position: relative;
        }

        .bar-label {
            margin-top: 5px;
            font-size: 12px;
            color: #666;
        }

        .chart-title {
            text-align: center;
            margin-bottom: 10px;
            color: #764ba2;
            font-weight: 600;
        }

        /* کارت‌های خلاصه */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            text-align: center;
        }

        .card h3 {
            color: #764ba2;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .card p {
            font-size: 24px;
            font-weight: 700;
            color: #333;
        }

        /* لیست فعالیت‌ها */
        .activity-list {
            margin-top: 20px;
        }

        .activity-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .activity-info h4 {
            color: #764ba2;
            margin-bottom: 5px;
        }

        .activity-meta {
            display: flex;
            font-size: 14px;
            color: #666;
        }

        .activity-meta span {
            margin-left: 10px;
        }

        /* یادآوری */
        .reminder {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            border-right: 4px solid #764ba2;
        }

        /* فوتر */
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            font-size: 14px;
        }

        /* ریسپانسیو */
        @media (max-width: 600px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .tabs {
                flex-wrap: wrap;
            }

            .tab {
                padding: 8px 15px;
                font-size: 14px;
            }

            .summary-cards {
                grid-template-columns: 1fr;
            }
        }

        /* استایل‌های جدید برای ویژگی‌های اضافه شده */
        .child-selector select {
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid #ddd;
            background: white;
            font-size: 14px;
        }

        #vaccination-schedule ul {
            list-style-type: none;
            padding: 10px;
            background: #f9f7fe;
            border-radius: 10px;
        }

        #vaccination-schedule li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        #print-report {
            margin-top: 20px;
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>دفترچه هوشمند رشد کودک</h1>
        <p>همراهی زیبای شما در مسیر رشد فرزند دلبندتان</p>
        <div class="child-selector">
            <select id="current-child">
                <option value="child1">فرزند اول (گلبار)</option>
                <option value="child2">فرزند دوم</option>
                <option value="add-child">+ افزودن فرزند جدید</option>
            </select>
        </div>
    </div>

    <div class="container">
        <div class="tabs">
            <div class="tab active" data-tab="dashboard">داشبورد</div>
            <div class="tab" data-tab="add-activity">ثبت فعالیت</div>
            <div class="tab" data-tab="growth">رشد کودک</div>
            <div class="tab" data-tab="history">تاریخچه</div>
        </div>

        <!-- تب داشبورد -->
        <div id="dashboard" class="tab-content active">
            <h2>خلاصه امروز</h2>

            <div class="reminder">
                <p>یادآوری: امروز به کودکت لبخند زدی؟ لحظات زیبا را ثبت کن!</p>
            </div>

            <div class="summary-cards">
                <div class="card">
                    <h3>وعده‌های غذایی امروز</h3>
                    <p id="today-meals">0</p>
                </div>
                <div class="card">
                    <h3>مدت خواب امروز</h3>
                    <p id="today-sleep">0 ساعت</p>
                </div>
                <div class="card">
                    <h3>حالت روحی</h3>
                    <p id="today-mood">--</p>
                </div>
                <div class="card">
                    <h3>تحلیل رشد</h3>
                    <p id="growth-analysis">داده کافی برای تحلیل وجود ندارد</p>
                </div>
            </div>

            <h3 style="margin-top: 30px;">آخرین فعالیت‌ها</h3>
            <div id="recent-activities" class="activity-list">
                <!-- فعالیت‌ها اینجا نمایش داده می‌شوند -->
            </div>
        </div>

        <!-- تب ثبت فعالیت -->
        <div id="add-activity" class="tab-content">
            <h2>ثبت فعالیت جدید</h2>

            <div class="form-group">
                <label for="activity-type">نوع فعالیت</label>
                <select id="activity-type">
                    <option value="meal">وعده غذایی</option>
                    <option value="sleep">خواب</option>
                    <option value="play">بازی</option>
                    <option value="health">سلامتی</option>
                    <option value="other">سایر</option>
                </select>
            </div>

            <div class="form-group" id="meal-details">
                <label for="meal-type">نوع وعده</label>
                <select id="meal-type">
                    <option value="breakfast">صبحانه</option>
                    <option value="lunch">ناهار</option>
                    <option value="dinner">شام</option>
                    <option value="snack">میان وعده</option>
                </select>

                <label for="meal-amount" style="margin-top: 15px;">مقدار مصرف (درصد)</label>
                <input type="range" id="meal-amount" min="0" max="100" value="50">
                <span id="meal-amount-value">50%</span>
            </div>

            <div class="form-group" id="sleep-details" style="display: none;">
                <label for="sleep-duration">مدت خواب (ساعت)</label>
                <input type="number" id="sleep-duration" min="0" max="24" step="0.5" value="2">

                <label for="sleep-quality" style="margin-top: 15px;">کیفیت خواب</label>
                <select id="sleep-quality">
                    <option value="excellent">عالی</option>
                    <option value="good">خوب</option>
                    <option value="fair">متوسط</option>
                    <option value="poor">ضعیف</option>
                </select>
            </div>

            <div class="form-group" id="mood-details">
                <label for="child-mood">حالت روحی کودک</label>
                <select id="child-mood">
                    <option value="happy">شاد</option>
                    <option value="calm">آرام</option>
                    <option value="excited">هیجان‌زده</option>
                    <option value="sad">ناراحت</option>
                    <option value="angry">عصبی</option>
                </select>
            </div>

            <div class="form-group">
                <label for="activity-notes">توضیحات (اختیاری)</label>
                <textarea id="activity-notes" rows="3"></textarea>
            </div>

            <button id="save-activity-btn">ذخیره فعالیت</button>
        </div>

        <!-- تب رشد کودک -->
        <div id="growth" class="tab-content">
            <h2>رشد کودک</h2>

            <div class="form-group">
                <label for="child-birthdate">تاریخ تولد کودک</label>
                <input type="date" id="child-birthdate">
            </div>

            <div id="vaccination-schedule" style="margin-top: 20px; display: none;">
                <h3>برنامه واکسیناسیون</h3>
                <ul id="vaccine-list"></ul>
            </div>

            <div class="chart-container">
                <h3 class="chart-title">قد کودک (سانتی‌متر)</h3>
                <canvas id="height-chart"></canvas>
            </div>

            <div class="chart-container">
                <h3 class="chart-title">وزن کودک (کیلوگرم)</h3>
                <canvas id="weight-chart"></canvas>
            </div>

            <div class="form-group">
                <label for="child-height">قد فعلی (سانتی‌متر)</label>
                <input type="number" id="child-height" min="30" max="200">
            </div>

            <div class="form-group">
                <label for="child-weight">وزن فعلی (کیلوگرم)</label>
                <input type="number" id="child-weight" min="2" max="100" step="0.1">
            </div>

            <button id="save-growth-btn">ذخیره اطلاعات رشد</button>
            <button id="print-report">چاپ گزارش رشد</button>
        </div>

        <!-- تب تاریخچه -->
        <div id="history" class="tab-content">
            <h2>تاریخچه فعالیت‌ها</h2>

            <div class="form-group">
                <label for="history-filter">فیلتر بر اساس نوع</label>
                <select id="history-filter">
                    <option value="all">همه فعالیت‌ها</option>
                    <option value="meal">وعده‌های غذایی</option>
                    <option value="sleep">خواب</option>
                    <option value="play">بازی</option>
                    <option value="health">سلامتی</option>
                </select>
            </div>

            <div id="all-activities" class="activity-list">
                <!-- تمام فعالیت‌ها اینجا نمایش داده می‌شوند -->
            </div>
        </div>
    </div>

    <div class="footer">
        <p>دفترچه هوشمند رشد کودک - طراحی شده برای جشنواره</p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // متغیرهای جهانی
        let children = {
            child1: {
                name: "گلبار",
                activities: JSON.parse(localStorage.getItem('childActivities_child1')) || [],
                growthData: JSON.parse(localStorage.getItem('childGrowthData_child1')) || [],
                birthdate: null
            },
            child2: {
                name: "فرزند دوم",
                activities: JSON.parse(localStorage.getItem('childActivities_child2')) || [],
                growthData: JSON.parse(localStorage.getItem('childGrowthData_child2')) || [],
                birthdate: null
            }
        };

        let currentChildId = 'child1';
        let activities = children[currentChildId].activities;
        let growthData = children[currentChildId].growthData;

        // هنگام لود صفحه
        document.addEventListener('DOMContentLoaded', function() {
            // مقداردهی اولیه تب‌ها
            initTabs();

            // رویدادهای فرم ثبت فعالیت
            document.getElementById('activity-type').addEventListener('change', function() {
                const activityType = this.value;
                document.getElementById('meal-details').style.display = activityType === 'meal' ? 'block' : 'none';
                document.getElementById('sleep-details').style.display = activityType === 'sleep' ? 'block' : 'none';
            });

            // نمایش مقدار اسلایدر مقدار غذا
            document.getElementById('meal-amount').addEventListener('input', function() {
                document.getElementById('meal-amount-value').textContent = this.value + '%';
            });

            // رویداد کلیک دکمه ذخیره فعالیت
            document.getElementById('save-activity-btn').addEventListener('click', saveActivity);

            // رویداد کلیک دکمه ذخیره رشد
            document.getElementById('save-growth-btn').addEventListener('click', saveGrowthData);

            // رویداد تغییر فیلتر تاریخچه
            document.getElementById('history-filter').addEventListener('change', filterActivities);

            // رویداد تغییر فرزند
            document.getElementById('current-child').addEventListener('change', function() {
                const selected = this.value;
                if (selected === 'add-child') {
                    const name = prompt('نام فرزند جدید را وارد کنید:');
                    if (name) {
                        const id = 'child' + (Object.keys(children).length + 1);
                        children[id] = { 
                            name, 
                            activities: [], 
                            growthData: [],
                            birthdate: null
                        };
                        
                        // آپدیت dropdown
                        const select = document.getElementById('current-child');
                        select.innerHTML = Object.entries(children).map(([id, child]) => 
                            `<option value="${id}">${child.name}</option>`
                        ).join('') + '<option value="add-child">+ افزودن فرزند جدید</option>';
                        
                        select.value = id;
                        currentChildId = id;
                        loadChildData(id);
                    } else {
                        this.value = currentChildId;
                    }
                } else {
                    currentChildId = selected;
                    loadChildData(selected);
                }
            });

            // رویداد تاریخ تولد
            document.getElementById('child-birthdate').addEventListener('change', function() {
                const birthdate = new Date(this.value);
                if (isNaN(birthdate.getTime())) return;

                children[currentChildId].birthdate = birthdate;
                updateVaccinationSchedule(birthdate);
            });

            // رویداد چاپ گزارش
            document.getElementById('print-report').addEventListener('click', printGrowthReport);

            // به روزرسانی اولیه محتوا
            updateDashboard();
            updateGrowthCharts();
            updateActivityHistory();
            checkReminders();

            // چک کردن یادآوری‌ها هر دقیقه
            setInterval(checkReminders, 60000);
        });

        // تابع مقداردهی اولیه تب‌ها
        function initTabs() {
            const tabs = document.querySelectorAll('.tab');

            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    openTab(tabId);
                });
            });
        }

        // تابع تغییر تب‌ها
        function openTab(tabId) {
            // مخفی کردن همه تب‌ها
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // غیرفعال کردن همه تب‌ها
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // فعال کردن تب انتخاب شده
            document.getElementById(tabId).classList.add('active');
            document.querySelector(`.tab[data-tab="${tabId}"]`).classList.add('active');

            // به روزرسانی محتوای تب در صورت نیاز
            if (tabId === 'dashboard') {
                updateDashboard();
            } else if (tabId === 'growth') {
                updateGrowthCharts();
            } else if (tabId === 'history') {
                updateActivityHistory();
            }
        }

        // بارگذاری داده‌های فرزند انتخاب شده
        function loadChildData(childId) {
            activities = children[childId].activities;
            growthData = children[childId].growthData;
            
            // آپدیت تاریخ تولد در فرم
            if (children[childId].birthdate) {
                const dateStr = children[childId].birthdate.toISOString().split('T')[0];
                document.getElementById('child-birthdate').value = dateStr;
                updateVaccinationSchedule(children[childId].birthdate);
            } else {
                document.getElementById('child-birthdate').value = '';
                document.getElementById('vaccination-schedule').style.display = 'none';
            }
            
            updateDashboard();
            updateGrowthCharts();
            updateActivityHistory();
        }

        // ذخیره فعالیت جدید
        function saveActivity() {
            const activityType = document.getElementById('activity-type').value;
            const mood = document.getElementById('child-mood').value;
            const notes = document.getElementById('activity-notes').value;
            const now = new Date();

            let activity = {
                id: Date.now(),
                type: activityType,
                mood: mood,
                notes: notes,
                date: now.toLocaleDateString('fa-IR'),
                time: now.toLocaleTimeString('fa-IR'),
                timestamp: now.getTime()
            };

            // جزئیات خاص بر اساس نوع فعالیت
            if (activityType === 'meal') {
                activity.mealType = document.getElementById('meal-type').value;
                activity.amount = document.getElementById('meal-amount').value;
            } else if (activityType === 'sleep') {
                activity.duration = document.getElementById('sleep-duration').value;
                activity.quality = document.getElementById('sleep-quality').value;
            }

            activities.push(activity);
            children[currentChildId].activities = activities;
            localStorage.setItem(`childActivities_${currentChildId}`, JSON.stringify(activities));

            // ریست فرم
            document.getElementById('activity-notes').value = '';

            // نمایش پیام موفقیت
            alert('فعالیت با موفقیت ثبت شد!');

            // به روزرسانی داشبورد
            updateDashboard();
        }

        // ذخیره اطلاعات رشد
        function saveGrowthData() {
            const height = document.getElementById('child-height').value;
            const weight = document.getElementById('child-weight').value;
            const now = new Date();

            if (!height || !weight) {
                alert('لطفاً هم قد و هم وزن را وارد کنید');
                return;
            }

            const growthRecord = {
                date: now.toLocaleDateString('fa-IR'),
                height: parseInt(height),
                weight: parseFloat(weight),
                timestamp: now.getTime()
            };

            growthData.push(growthRecord);
            children[currentChildId].growthData = growthData;
            localStorage.setItem(`childGrowthData_${currentChildId}`, JSON.stringify(growthData));

            // ریست فرم
            document.getElementById('child-height').value = '';
            document.getElementById('child-weight').value = '';

            // به روزرسانی نمودارها
            updateGrowthCharts();
            updateDashboard(); // برای آپدیت تحلیل رشد

            // نمایش پیام موفقیت
            alert('اطلاعات رشد با موفقیت ثبت شد!');
        }

        // به روزرسانی داشبورد
        function updateDashboard() {
            const today = new Date().toLocaleDateString('fa-IR');

            // فیلتر فعالیت‌های امروز
            const todayActivities = activities.filter(activity => activity.date === today);

            // محاسبه آمار
            const meals = todayActivities.filter(a => a.type === 'meal').length;
            const sleepHours = todayActivities.filter(a => a.type === 'sleep')
                .reduce((sum, a) => sum + parseFloat(a.duration), 0);
            const moods = todayActivities.map(a => a.mood);
            const latestMood = moods.length > 0 ? moods[moods.length - 1] : '--';

            // نمایش آمار
            document.getElementById('today-meals').textContent = meals;
            document.getElementById('today-sleep').textContent = sleepHours + ' ساعت';
            document.getElementById('today-mood').textContent = getMoodText(latestMood);

            // نمایش تحلیل رشد
            document.getElementById('growth-analysis').textContent = analyzeGrowth() || "داده کافی برای تحلیل وجود ندارد";

            // نمایش آخرین فعالیت‌ها
            const recentActivitiesContainer = document.getElementById('recent-activities');
            recentActivitiesContainer.innerHTML = '';

            const recentToShow = activities.slice(-5).reverse();

            if (recentToShow.length === 0) {
                recentActivitiesContainer.innerHTML = '<p>هنوز فعالیتی ثبت نشده است</p>';
                return;
            }

            recentToShow.forEach(activity => {
                const activityElement = createActivityElement(activity);
                recentActivitiesContainer.appendChild(activityElement);
            });
        }

        // به روزرسانی نمودارهای رشد
        function updateGrowthCharts() {
            if (growthData.length === 0) {
                document.getElementById('height-chart').innerHTML = '<p>داده‌ای برای نمایش وجود ندارد</p>';
                document.getElementById('weight-chart').innerHTML = '<p>داده‌ای برای نمایش وجود ندارد</p>';
                return;
            }

            // مرتب سازی داده‌ها بر اساس تاریخ
            const sortedData = [...growthData].sort((a, b) => a.timestamp - b.timestamp);

            // نمودار قد
            const heightCtx = document.getElementById('height-chart').getContext('2d');
            
            // اگر نمودار قبلی وجود دارد، آن را پاک کنید
            if (window.heightChart) {
                window.heightChart.destroy();
            }
            
            window.heightChart = new Chart(heightCtx, {
                type: 'line',
                data: {
                    labels: sortedData.map(d => d.date),
                    datasets: [{
                        label: 'قد (سانتی‌متر)',
                        data: sortedData.map(d => d.height),
                        borderColor: '#764ba2',
                        backgroundColor: 'rgba(118, 75, 162, 0.1)',
                        tension: 0.1,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: false }
                    }
                }
            });

            // نمودار وزن
            const weightCtx = document.getElementById('weight-chart').getContext('2d');
            
            // اگر نمودار قبلی وجود دارد، آن را پاک کنید
            if (window.weightChart) {
                window.weightChart.destroy();
            }
            
            window.weightChart = new Chart(weightCtx, {
                type: 'line',
                data: {
                    labels: sortedData.map(d => d.date),
                    datasets: [{
                        label: 'وزن (کیلوگرم)',
                        data: sortedData.map(d => d.weight),
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.1,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: false }
                    }
                }
            });
        }

        // به روزرسانی تاریخچه فعالیت‌ها
        function updateActivityHistory() {
            const activitiesContainer = document.getElementById('all-activities');
            activitiesContainer.innerHTML = '';

            if (activities.length === 0) {
                activitiesContainer.innerHTML = '<p>هنوز فعالیتی ثبت نشده است</p>';
                return;
            }

            const sortedActivities = [...activities].sort((a, b) => b.timestamp - a.timestamp);

            sortedActivities.forEach(activity => {
                const activityElement = createActivityElement(activity);
                activitiesContainer.appendChild(activityElement);
            });
        }

        // فیلتر فعالیت‌ها در تاریخچه
        function filterActivities() {
            const filterType = document.getElementById('history-filter').value;
            const activitiesContainer = document.getElementById('all-activities');
            activitiesContainer.innerHTML = '';

            let filteredActivities = [...activities];

            if (filterType !== 'all') {
                filteredActivities = activities.filter(a => a.type === filterType);
            }

            if (filteredActivities.length === 0) {
                activitiesContainer.innerHTML = '<p>فعالیتی با این فیلتر یافت نشد</p>';
                return;
            }

            filteredActivities.sort((a, b) => b.timestamp - a.timestamp)
                .forEach(activity => {
                    const activityElement = createActivityElement(activity);
                    activitiesContainer.appendChild(activityElement);
                });
        }

        // ایجاد عنصر فعالیت برای نمایش
        function createActivityElement(activity) {
            const activityElement = document.createElement('div');
            activityElement.className = 'activity-item';

            const activityInfo = document.createElement('div');
            activityInfo.className = 'activity-info';

            const title = document.createElement('h4');
            title.textContent = getActivityTitle(activity);

            const meta = document.createElement('div');
            meta.className = 'activity-meta';

            const dateSpan = document.createElement('span');
            dateSpan.textContent = activity.date;

            const timeSpan = document.createElement('span');
            timeSpan.textContent = activity.time;

            const moodSpan = document.createElement('span');
            moodSpan.textContent = 'حالت: ' + getMoodText(activity.mood);

            meta.appendChild(dateSpan);
            meta.appendChild(timeSpan);
            meta.appendChild(moodSpan);

            activityInfo.appendChild(title);
            activityInfo.appendChild(meta);

            if (activity.notes) {
                const notes = document.createElement('p');
                notes.textContent = activity.notes;
                notes.style.marginTop = '10px';
                notes.style.color = '#666';
                activityInfo.appendChild(notes);
            }

            activityElement.appendChild(activityInfo);

            return activityElement;
        }

        // دریافت عنوان فعالیت
        function getActivityTitle(activity) {
            switch (activity.type) {
                case 'meal':
                    return `وعده غذایی (${getMealTypeText(activity.mealType)}) - ${activity.amount}% مصرف`;
                case 'sleep':
                    return `خواب (${activity.duration} ساعت - کیفیت ${getSleepQualityText(activity.quality)})`;
                case 'play':
                    return 'بازی و فعالیت';
                case 'health':
                    return 'سلامتی و مراقبت';
                default:
                    return 'فعالیت دیگر';
            }
        }

        // دریافت متن نوع وعده غذایی
        function getMealTypeText(type) {
            const mealTypes = {
                'breakfast': 'صبحانه',
                'lunch': 'ناهار',
                'dinner': 'شام',
                'snack': 'میان وعده'
            };
            return mealTypes[type] || type;
        }

        // دریافت متن کیفیت خواب
        function getSleepQualityText(quality) {
            const qualities = {
                'excellent': 'عالی',
                'good': 'خوب',
                'fair': 'متوسط',
                'poor': 'ضعیف'
            };
            return qualities[quality] || quality;
        }

        // دریافت متن حالت روحی
        function getMoodText(mood) {
            const moods = {
                'happy': 'شاد',
                'calm': 'آرام',
                'excited': 'هیجان‌زده',
                'sad': 'ناراحت',
                'angry': 'عصبی'
            };
            return moods[mood] || mood;
        }

        // تحلیل رشد کودک
        function analyzeGrowth() {
            if (growthData.length < 3) return null;

            const heights = growthData.map(d => d.height);
            const weights = growthData.map(d => d.weight);
            
            // تحلیل ساده رشد
            const heightTrend = heights[heights.length-1] - heights[0] > 0 ? "صعودی" : "نزولی";
            const weightTrend = weights[weights.length-1] - weights[0] > 0 ? "صعودی" : "نزولی";

            let message = `تحلیل رشد: `;
            message += `قد کودک روند ${heightTrend} دارد. `;
            message += `وزن کودک روند ${weightTrend} دارد. `;

            if (heightTrend === "صعودی" && weightTrend === "صعودی") {
                message += "کودک شما رشد مناسبی دارد!";
            } else {
                message += "با پزشک متخصص مشورت کنید.";
            }

            return message;
        }

        // به روزرسانی برنامه واکسیناسیون
        function updateVaccinationSchedule(birthdate) {
            const now = new Date();
            const ageInMonths = (now.getFullYear() - birthdate.getFullYear()) * 12 + 
                                (now.getMonth() - birthdate.getMonth());
            
            const vaccines = [
                { name: "هپاتیت B", months: [0] },
                { name: "پنتاوالان (دیفتری، کزاز، سیاه سرفه، هپاتیت B، هیب)", months: [2, 4, 6] },
                { name: "MMR (سرخک، سرخجه، اوریون)", months: [12] }
            ];

            const vaccineList = document.getElementById('vaccine-list');
            vaccineList.innerHTML = '';
            let hasUpcoming = false;

            vaccines.forEach(vaccine => {
                vaccine.months.forEach(month => {
                    if (ageInMonths >= month) {
                        const li = document.createElement('li');
                        li.textContent = `${vaccine.name} - تکمیل شده (سن: ${month} ماهگی)`;
                        li.style.color = 'green';
                        vaccineList.appendChild(li);
                    } else {
                        hasUpcoming = true;
                        const li = document.createElement('li');
                        li.textContent = `${vaccine.name} - در پیش رو (سن: ${month} ماهگی)`;
                        li.style.color = 'orange';
                        vaccineList.appendChild(li);
                    }
                });
            });

            document.getElementById('vaccination-schedule').style.display = 'block';
        }

        // چاپ گزارش رشد
        function printGrowthReport() {
            if (growthData.length === 0) {
                alert('داده‌ای برای چاپ وجود ندارد');
                return;
            }

            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html lang="fa" dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <title>گزارش رشد کودک</title>
                    <style>
                        body { font-family: Tahoma; padding: 20px; }
                        h2 { color: #764ba2; text-align: center; }
                        h3 { text-align: center; color: #333; }
                        canvas { max-width: 100%; }
                        @media print {
                            body { padding: 0; }
                            button { display: none; }
                        }
                    </style>
                    <script src="https://cdn.jsdelivr.net/npm/chart.js"><\/script>
                </head>
                <body>
                    <h2>گزارش رشد کودک</h2>
                    <h3>${children[currentChildId].name}</h3>
                    <div style="display: flex; flex-wrap: wrap; justify-content: space-around; margin: 20px 0;">
                        <div style="width: 100%; max-width: 500px; margin-bottom: 20px;">
                            <h4>قد کودک (سانتی‌متر)</h4>
                            <canvas id="print-height-chart" width="400" height="300"></canvas>
                        </div>
                        <div style="width: 100%; max-width: 500px;">
                            <h4>وزن کودک (کیلوگرم)</h4>
                            <canvas id="print-weight-chart" width="400" height="300"></canvas>
                        </div>
                    </div>
                    <div style="margin: 20px 0; padding: 15px; background: #f5f5f5; border-radius: 8px;">
                        <h4>تحلیل رشد</h4>
                        <p>${analyzeGrowth() || "داده کافی برای تحلیل وجود ندارد"}</p>
                    </div>
                    <p style="text-align: left; font-size: 12px; color: #666;">
                        تاریخ چاپ: ${new Date().toLocaleDateString('fa-IR')} - ${new Date().toLocaleTimeString('fa-IR')}
                    </p>
                    <button onclick="window.print()" style="
                        background: #764ba2;
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 5px;
                        margin: 20px auto;
                        display: block;
                        cursor: pointer;
                    ">
                        چاپ گزارش
                    </button>
                    <script>
                        // مرتب سازی داده‌ها
                        const sortedData = ${JSON.stringify([...growthData].sort((a, b) => a.timestamp - b.timestamp))};
                        
                        // نمودار قد
                        const heightCtx = document.getElementById('print-height-chart').getContext('2d');
                        new Chart(heightCtx, {
                            type: 'line',
                            data: {
                                labels: sortedData.map(d => d.date),
                                datasets: [{
                                    label: 'قد (سانتی‌متر)',
                                    data: sortedData.map(d => d.height),
                                    borderColor: '#764ba2',
                                    backgroundColor: 'rgba(118, 75, 162, 0.1)',
                                    tension: 0.1,
                                    fill: true
                                }]
                            },
                            options: {
                                responsive: true,
                                scales: { y: { beginAtZero: false } }
                            }
                        });
                        
                        // نمودار وزن
                        const weightCtx = document.getElementById('print-weight-chart').getContext('2d');
                        new Chart(weightCtx, {
                            type: 'line',
                            data: {
                                labels: sortedData.map(d => d.date),
                                datasets: [{
                                    label: 'وزن (کیلوگرم)',
                                    data: sortedData.map(d => d.weight),
                                    borderColor: '#667eea',
                                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                                    tension: 0.1,
                                    fill: true
                                }]
                            },
                            options: {
                                responsive: true,
                                scales: { y: { beginAtZero: false } }
                            }
                        });
                    <\/script>
                </body>
                </html>
            `);
            printWindow.document.close();
        }

        // تابع بررسی یادآوری‌ها
        function checkReminders() {
            const now = new Date();
            const hours = now.getHours();
            
            // یادآوری وعده غذایی
            if (hours === 8 || hours === 13 || hours === 19) {
                const today = now.toLocaleDateString('fa-IR');
                const todayMeals = activities.filter(a => 
                    a.date === today && a.type === 'meal'
                );
                
                if (todayMeals.length === 0 && hours === 8) {
                    showNotification('یادآوری صبحانه', 'فراموش نکنید صبحانه کودک را ثبت کنید!');
                } else if (todayMeals.length === 1 && hours === 13) {
                    showNotification('یادآوری ناهار', 'زمان ثبت ناهار کودک فرا رسیده است.');
                } else if (todayMeals.length === 2 && hours === 19) {
                    showNotification('یادآوری شام', 'لطفاً شام کودک را ثبت نمایید.');
                }
            }
            
            // یادآوری خواب
            if (hours === 21) {
                const today = now.toLocaleDateString('fa-IR');
                const todaySleep = activities.filter(a => 
                    a.date === today && a.type === 'sleep'
                ).reduce((sum, a) => sum + parseFloat(a.duration), 0);
                
                if (todaySleep < 10) {
                    showNotification('یادآوری خواب', 'کودک شما امروز کمتر از 10 ساعت خوابیده است.');
                }
            }
        }

        // نمایش نوتیفیکیشن
        function showNotification(title, message) {
            // بررسی پشتیبانی مرورگر از Notifications API
            if (!("Notification" in window)) {
                console.log("مرورگر از نوتیفیکیشن دسکتاپ پشتیبانی نمی‌کند");
                return;
            }
            
            // بررسی مجوز نمایش نوتیفیکیشن
            if (Notification.permission === "granted") {
                new Notification(title, { body: message });
            } else if (Notification.permission !== "denied") {
                Notification.requestPermission().then(permission => {
                    if (permission === "granted") {
                        new Notification(title, { body: message });
                    }
                });
            }
        }

        // ذخیره داده‌ها هنگام بسته شدن صفحه
        window.addEventListener('beforeunload', function() {
            localStorage.setItem(`childActivities_${currentChildId}`, JSON.stringify(activities));
            localStorage.setItem(`childGrowthData_${currentChildId}`, JSON.stringify(growthData));
        });
    </script>
</body>
</html>